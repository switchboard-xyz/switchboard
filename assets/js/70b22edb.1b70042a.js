"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[9250],{54852:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>m});var n=a(49231);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),u=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},d=function(e){var t=u(e.components);return n.createElement(s.Provider,{value:t},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=u(a),h=r,m=p["".concat(s,".").concat(h)]||p[h]||c[h]||o;return a?n.createElement(m,i(i({ref:t},d),{},{components:a})):n.createElement(m,i({ref:t},d))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:r,i[1]=l;for(var u=2;u<o;u++)i[u]=a[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},58099:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>l,toc:()=>u});var n=a(95907),r=(a(49231),a(54852));const o={title:"Using Switchboard: Creating Custom Data Feeds",description:"",authors:["gallynaut"],tags:[],hide_table_of_contents:!0},i="Using Switchboard: Creating Custom Data Feeds",l={permalink:"/blog/2022/02/23/Using-Switchboard-Creating-Custom-Data-Feeds",source:"@site/blog/2022/02-23-Using-Switchboard-Creating-Custom-Data-Feeds.mdx",title:"Using Switchboard: Creating Custom Data Feeds",description:"",date:"2022-02-23T00:00:00.000Z",formattedDate:"February 23, 2022",tags:[],readingTime:3.755,hasTruncateMarker:!0,authors:[{name:"gallynaut",title:"Developer Relations",url:"https://twitter.com/gallynaut",imageURL:"https://pbs.twimg.com/profile_images/1649642820993679365/buRwDkVY_400x400.jpg",key:"gallynaut"}],frontMatter:{title:"Using Switchboard: Creating Custom Data Feeds",description:"",authors:["gallynaut"],tags:[],hide_table_of_contents:!0},prevItem:{title:"Switchboard x Riptide Prizes Announcement",permalink:"/blog/2022/02/25/Switchboard-Riptide-Prizes-Announcement"},nextItem:{title:"Switchboard Introduces TWAP Support",permalink:"/blog/2022/02/07/Switchboard-Introduces-TWAP-Support"}},s={authorsImageUrls:[void 0]},u=[{value:"Build Job Definition",id:"build-job-definition",level:2},{value:"Data Sources",id:"data-sources",level:3},{value:"Parse Response",id:"parse-response",level:3},{value:"Build Task Definitions",id:"build-task-definitions",level:3},{value:"Build Data Feed",id:"build-data-feed",level:2},{value:"Configure Data Feed",id:"configure-data-feed",level:3},{value:"Create Data Feed",id:"create-data-feed",level:3},{value:"Conclusion",id:"conclusion",level:2}],d={toc:u},p="wrapper";function c(e){let{components:t,...a}=e;return(0,r.kt)(p,(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Switchboard is a permission-less Oracle network allowing anyone to spin up their\nown data feeds and publish on-chain. To accomplish this, data feeds can be\nconfigured from a collection of tasks in order to fetch data, parse a response,\nthen determine a final result. You can find a list of available tasks in our\ndocumentation. Today\u2019s article will walk you through spinning up your own data\nfeed to fetch the current weather in Miami, FL using Switchboard\u2019s publisher\nsite. This could be used by an on-chain program to calculate and settle\ninsurance contracts relating to weather events."),(0,r.kt)("h2",{id:"build-job-definition"},"Build Job Definition"),(0,r.kt)("h3",{id:"data-sources"},"Data Sources"),(0,r.kt)("p",null,"A data feed should have multiple sources but for this example we\u2019ll keep it\nsimple. We\u2019ll be using the\n",(0,r.kt)("a",{parentName:"p",href:"https://www.weather.gov/documentation/services-web-api#/default/gridpoint"},"api.weather.gov/gridpoints"),"\nendpoint to resolve our data feed. After doing some digging we\u2019ve determined\nthat the weather forecast office should be ",(0,r.kt)("strong",{parentName:"p"},"MFL")," and the latitude and\nlongitude should be 111 and 50 respectively. So our full API endpoint should be\n",(0,r.kt)("a",{parentName:"p",href:"https://api.weather.gov/gridpoints/MFL/111,50/forecast"},"https://api.weather.gov/gridpoints/MFL/111,50/forecast"),".\nWe\u2019ll pass this URL as the argument to the httpTask."),(0,r.kt)("h3",{id:"parse-response"},"Parse Response"),(0,r.kt)("p",null,"Now we need to extract the value from the API response. Here is what the\nresponse will look like:"),(0,r.kt)("iframe",{src:"https://medium.com/media/efe4c82a9487835fcd6d62c5d5dd9055",frameborder:"0"}),(0,r.kt)("p",null,"We can use the JsonParseTask to extract this value. This relies on using\nJsonPath syntax to grab a value.",(0,r.kt)("a",{parentName:"p",href:"https://jsonpath.com/"}," https://jsonpath.com"),"\nis a great resource to test your queries. After some trial and error we\u2019ve\ndetermined that the JSON path query should be\n\u201c$.properties.periods.0.temperature\u201d. This will access the first array element\nin the properties.periods object and return that period\u2019s temperature. So now\nwe\u2019ve figured out how to fetch the weather data and extract the latest\ntemperature value."),(0,r.kt)("h3",{id:"build-task-definitions"},"Build Task Definitions"),(0,r.kt)("p",null,"Now we can put it all together. The httpTask will be used to fetch external\ndata, then pass it to the jsonParseTask to extract the latest temperature value.\nThe final definition will look like this:"),(0,r.kt)("iframe",{src:"https://medium.com/media/132f06aaba39e0b0e9f91d97cac4395b",frameborder:"0"}),(0,r.kt)("h2",{id:"build-data-feed"},"Build Data Feed"),(0,r.kt)("p",null,"When building a Switchboard data feed, you will need to create the following\naccounts:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Aggregator \u2014 to manage the data feed configuration and store the result")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Job(s) \u2014 to store each job definition (only one needed for our example)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Lease \u2014 to pre-fund oracles for any update request")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Permission \u2014 permits an aggregator to use a set of oracles"))),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/3200/0*YaoRCEngI8vcvb00",alt:null})),(0,r.kt)("p",null,"Luckily the ",(0,r.kt)("a",{parentName:"p",href:"https://publish.switchboard.xyz/"},"Switchboard Publisher site"),"\nstreamlines the on-chain workflow and handles this for us. We\u2019ll be creating a\nnew data feed for Switchboard\u2019s permission-less queue. Optionally, you can\nrequest permissions to Switchboard\u2019s permissioned queue once you are satisfied\nwith the feed\u2019s configuration."),(0,r.kt)("h3",{id:"configure-data-feed"},"Configure Data Feed"),(0,r.kt)("p",null,"Connect your wallet, then locate and select the ",(0,r.kt)("em",{parentName:"p"},"Custom Feed")," button. The\nfollowing popup lets you configure the name of your feed, as well as the job\ndefinitions. Our example uses a single job."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/2000/0*RNVzR-Gv-tI9e8yx",alt:null})),(0,r.kt)("p",null,"Give your feed a name such as ",(0,r.kt)("em",{parentName:"p"},"MIA Temperature,")," then select ",(0,r.kt)("em",{parentName:"p"},"Add Job+"),". Give\nthe job a name, such as Weather.gov MIA, then paste in the job definition from\nabove. You can hit ",(0,r.kt)("em",{parentName:"p"},"Test")," to simulate the result to ensure you are using the\ncorrect job definition."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/2000/0*EdbEKh2EegG7kAQT",alt:null})),(0,r.kt)("p",null,"Select ",(0,r.kt)("em",{parentName:"p"},"Add Job")," to be taken back to the Build a Feed modal. Then select ",(0,r.kt)("em",{parentName:"p"},"Add\nFeed")," to add the feed to your basket."),(0,r.kt)("h3",{id:"create-data-feed"},"Create Data Feed"),(0,r.kt)("p",null,"You should have the weather feed in your basket and ready for checkout."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/2000/1*_Ywdq0LL75kJkZxO8vjTvQ.png",alt:null})),(0,r.kt)("p",null,"Select ",(0,r.kt)("em",{parentName:"p"},"Checkout")," to begin publishing your feed on-chain. You should see the\nfollowing modal to fund your lease contract:"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/2000/1*9gB-dywmlXFRUY4qNrD1lA.png",alt:null})),(0,r.kt)("p",null,"This step will deposit the specified SOL amount into a lease contract. If the\n",(0,r.kt)("em",{parentName:"p"},"Enable automatic updates")," checkbox is selected, your feed will be added to the\ncrank and updated at a regular interval of your choosing. Note the exact update\ntimes are dependent on the Solana network and an added jitter. Each time your\nfeed successfully updates, a portion of the lease contract will be dispersed to\nthe oracles fulfilling the update request. When you are happy with the settings,\nselect ",(0,r.kt)("em",{parentName:"p"},"Go to Checkout"),"."),(0,r.kt)("p",null,"The Checkout Exchange modal will display a summary of the account creation cost.\nSelect ",(0,r.kt)("em",{parentName:"p"},"Create Feed")," to start the on-chain account creation."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/2000/1*EVfnM7Z2n-L-QoyIIWfNAA.png",alt:null})),(0,r.kt)("p",null,"Once complete, you should see your new data feed on the ",(0,r.kt)("em",{parentName:"p"},"Your Feeds")," page\nalready updating!"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn-images-1.medium.com/max/2000/1*qN18XKbiGxeGyWrhSIHXSg.png",alt:null})),(0,r.kt)("h2",{id:"conclusion"},"Conclusion"),(0,r.kt)("p",null,"Switchboard allows developers to build and configure their own on-chain data\nfeeds. If you\u2019re building with Switchboard and need a new task type or\nadditional functionality please reach out to us on Discord, Telegram, or\nTwitter."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://docs.switchboard.xyz/job-directory"},"Job Directory"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://docs.switchboard.xyz/architecture/feeds"},"Data Feeds Architecture"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://docs.switchboard.xyz/api/tasks"},"Switchboard Tasks")))))}c.isMDXComponent=!0}}]);