---
keywords:
  [Switchboard, web3, oracle, data feeds, vrf, randomness, solana, aptos, near]
---

# The Attestation Program

Previously, Switchboard's security model depended on economic incentives where
data reporters were rewarded or penalized based on the proximity of their
reported data to the median. Oracle operators had to lock up a portion of
economic stake and receive explicit approval from the oracle queue's authority.
Although this model provided a degree of decentralization and security, it faced
challenges in aligning the incentives of oracles with DeFi protocols.

The Switchboard Attestation Program builds upon Switchboard V2s enconomic
incentives by leveraging TEEs. TEEs allow for unique digital signatures to be
created for software running within its enclave, along with the data generated
by that software. This ensures the secure and verifiable confirmation of the
oracles' integrity and authenticity.

The Switchboard Attestation Program is a sibling program to the Switchboard
oracle program, and is responsible for verifying attestation quotes on-chain,
which grants or revokes an oracle's permissions based on the contents within the
secure enclave. By verifying the code's integrity inside the enclave, we can
ensure the code hasn't been tampered with and that our application will behave
as expected.

<!--
![Attestation Program Account Decomposition](/img/arch/Attestation_Program_Account_Decomposition.png)
-->

A AttestationQueueAccount manages a set of valid MRENCLAVE measurements,
representing the permitted software versions an application can run. Any code
changes will alter the enclave's state, necessitating the addition of a new
measurement by the AttestationQueueAccount `authority` before oracles can
upgrade. If a version is found to have a bug, it can be revoked, and oracles
will automatically be removed.

An oracle account represents a specific SGX enclave. When an oracle is
provisioned, it creates a EnclaveAccount on-chain with the MRENCLAVE measurement
detailing the software version it runs. Quote verification oracles constantly
monitor the chain for oracles requesting verification of their enclave. Upon
detecting such an event, it calls the program and updates or revokes the
associated PermissionAccount based on whether the measurement is allowed on the
oracle's AttestationQueueAccount.

AttestationQueueAccounts dictate how often oracles must verify their enclave,
ensuring that enclaves consistently update and maintain software patches.

With the Attestation Program, Switchboard V3 enables:

- **Oracle Verification**: Oracles are encapsulated within TEEs, generating a
  unique digital signature that can be posted on-chain for public verification.
  This ensures that the oracles can be trusted while maintaining a decentralized
  and verifiable system.
- **Execution Verification**: As oracles participate in a queue and handle user
  requests, the executions of data feeds, functions, and other tasks can be
  verifiably carried out. This allows users to confirm that transactions are
  strictly dictated by the code that created them, ensuring system integrity and
  security.

## Exploring SGX Attestation

Intel Software Guard Extensions (SGX) offer a secure execution environment
called an enclave, where sensitive code and data are protected from unauthorized
access or tampering. The attestation process verifies the enclave's identity and
validates its code and data, ensuring authenticity and integrity.

The Switchboard Attestation Program uses SGX attestation to establish trust in
oracle applications, providing a robust mechanism for verifying secure code
execution within the Trusted Execution Environment (TEE).

Switchboard services utilize Gramine for the runtime environment. Gramine allows
SGX enclaves to operate as if they were running on a standard operating system,
managing system calls and other essential interactions.

## Crucial Components in the Attestation Process

The Switchboard attestation process involves several components that work
together to facilitate attestation and verification of SGX enclaves:

- **AttestationQueueAccount**: Manages the list of allowed enclave measurements
  (MRENCLAVEs) and maintains a dedicated AttestationQueue to verify
  attestations.
- **EnclaveAccount**: Represents an individual SGX enclave, connects to the
  AttestationQueueAccount, and has a 1:N relationship with EnclaveAccount.
- **PermissionAccount**: An account between the _AttestationQueueAccount_ and
  the _EnclaveAccount_ dictating whether the _EnclaveAccount_ is permitted to
  perform on-chain actions.
- **EnclaveAccount**: Stores the attestation data (quote) generated by the SGX
  enclave for a given EnclaveAccount.

## Attestation Lifecycle

The Switchboard Attestation Program follows a structured lifecycle to ensure the
secure and trustworthy execution of code within the TEE:

1. Initialize the AttestationQueueAccount
2. Register permitted MRENCLAVE measurements
3. Create EnclaveAccount and PermissionAccount
4. Run an SGX Switchboard function, creates EnclaveAccount from compiled binary
5. EnclaveAccount emits a request to the AttestationQueue associated with the
   ServiceQueue to verify its MRENCLAVE measurement
6. The AttestationQueue verifies the MRENCLAVE measurement on-chain
   (attestation)
7. The PermissionAccount associated with the EnclaveAccount has the permissions
   enabled
8. Maintain an active and trustworthy SGX enclave through heartbeats

By adhering to this lifecycle, the Switchboard Attestation Program ensures the
security, authenticity, and trustworthiness of SGX enclaves operating within the
TEE.
