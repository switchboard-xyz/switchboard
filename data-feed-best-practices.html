<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-info/data-feed-best-practices">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Data Feed Best Practices | Switchboard</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.switchboard.xyz/img/documentation_card.jpg"><meta data-rh="true" name="twitter:image" content="https://docs.switchboard.xyz/img/documentation_card.jpg"><meta data-rh="true" property="og:url" content="https://docs.switchboard.xyz/data-feed-best-practices"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Data Feed Best Practices | Switchboard"><meta data-rh="true" name="description" content="Learn how to effectively build and manage Switchboard data feeds."><meta data-rh="true" property="og:description" content="Learn how to effectively build and manage Switchboard data feeds."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.switchboard.xyz/data-feed-best-practices"><link data-rh="true" rel="alternate" href="https://docs.switchboard.xyz/data-feed-best-practices" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.switchboard.xyz/data-feed-best-practices" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://XO84KDTPTB-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Switchboard RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Switchboard Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Switchboard" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.3d4442cb.css">
<link rel="preload" href="/assets/js/runtime~main.fbb92d72.js" as="script">
<link rel="preload" href="/assets/js/main.a7ce8f28.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_JVTn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Switchboard Logo" class="themedImage_Lc2C themedImage--light_OfHa" height="72" width="72"><img src="/img/logo_white.svg" alt="Switchboard Logo" class="themedImage_Lc2C themedImage--dark_aTa8" height="72" width="72"></div><b class="navbar__title text--truncate">Switchboard</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Docs</a><a class="navbar__item navbar__link" href="/api">API</a><div class="searchBox_aK9v"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="https://github.com/switchboard-xyz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar_icon__github" aria-label="GitHub repository"></a><a href="https://twitter.com/switchboardxyz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar_icon__twitter" aria-label="Twitter Link"></a><div class="toggle__fwT colorModeToggle_w9SD"><button class="clean-btn toggleButton_GPw6 toggleButtonDisabled_MbkH" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_IQ0H"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_XPgo"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_pt1U docsWrapper_x4Rk"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_yVT7" type="button"></button><div class="docPage_PuDF"><aside class="theme-doc-sidebar-container docSidebarContainer_WH5D"><div class="sidebarViewport_SH6O"><div class="sidebar_izeK"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_NUe_"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">üîå Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/getting-started">üöÄ Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/network">üåê The Network</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/the-oracle-problem">üîé Learn</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/solana">üõ†Ô∏è Solana</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/evm">üõ†Ô∏è EVM</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/aptos">üõ†Ô∏è Aptos</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/sui">üõ†Ô∏è Sui</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/near">üõ†Ô∏è NEAR</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/infra">üöß Infrastructure</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/data-feed-best-practices">‚ÑπÔ∏è More Info</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/data-feed-best-practices">Data Feed Best Practices</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/private-apis">Private APIs</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/security">üîê Security</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/terms">üìö Terminology</a></li></ul></nav></div></div></aside><main class="docMainContainer_pB8r"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_74nU"><div class="docItemContainer_rMDH"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_GQIx" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_LKiY"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">‚ÑπÔ∏è More Info</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Data Feed Best Practices</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_HO6K theme-doc-toc-mobile tocMobile_lc9y"><button type="button" class="clean-btn tocCollapsibleButton_Tbsf">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Data Feed Best Practices</h1></header><p>Developers building real world applications for web3 rely on oracles to relay
and publish data on-chain. Oracles are not a one size fit all solution, in fact
redundancy should be used depending on your use cases and risk tolerance.
Switchboard‚Äôs goal is to generalize data feeds and leave it up to the developer
to configure and tune their data flow. Today‚Äôs article looks at how Switchboard
feeds differ from other providers, and how you can configure your data feed to
increase economic security.</p><p>A Switchboard feed belongs to a single oracle queue, which is a realm of oracles
that get assigned to update requests in a round-robin fashion. The feed‚Äôs config
dictates how update requests are invoked and routed through the network, along
with a set of job accounts that define how data is sourced off-chain.
Switchboard data feeds can fetch data from http endpoints, websockets, or
on-chain sources. Switchboard feeds are meant to be generic enough to meet any
use case and leave it up to the on-chain consumers to configure.</p><h2 class="anchor anchorWithStickyNavbar_WPED" id="oracle-consensus">Oracle Consensus<a href="#oracle-consensus" class="hash-link" aria-label="Direct link to Oracle Consensus" title="Direct link to Oracle Consensus">‚Äã</a></h2><p>Switchboard uses rounds to open and close a batch of oracle responses. A
Switchboard feed has a specified minUpdateDelay which determines the minimum
time a round is open for in order to give the oracles enough time to respond.
When a new round is opened, the data feed gets assigned to a new batch of
oracles, which is configurable with the parameter oracleRequestBatchSize. After
minOracleResults responses are received, the on-chain program calculates the
result using the median of the oracle responses. The median ensures large
outliers do not drastically skew the accepted result, unlike averages. Oracles
who responded within the queue‚Äôs configured parameters are rewarded, while the
oracles who respond outside this threshold are slashed (if the queue has
slashingEnabled). As you can see, the oracle consensus can be configured by the
downstream user to provide the security necessary for their use case. Check out
the data feed docs for more information on the lifecycle of Switchboard data
feed updates.</p><p>This differs from other oracle solutions like Pyth where data feeds are sourced
from trusted market participants directly. This results in a faster update rate
but makes no guarantees on the number of sources that responded. With
Switchboard feeds you can guarantee a set number of sources and oracles have
responded before accepting the result on-chain.</p><h2 class="anchor anchorWithStickyNavbar_WPED" id="democratizing-data-feeds">Democratizing Data Feeds<a href="#democratizing-data-feeds" class="hash-link" aria-label="Direct link to Democratizing Data Feeds" title="Direct link to Democratizing Data Feeds">‚Äã</a></h2><p>Switchboard is a decentralized protocol that allows users to publish and request
updates from a pool of oracles. Switchboard oracles allocate their resources to
updates requested from on-chain consumers. This leaves it up to the consumer to
decide what data is brought on-chain.</p><p>Switchboard feeds are public meaning anyone is free to read the value on-chain
so sometimes it is ideal to piggy back on an existing feed. This works well for
some protocols but leaves you vulnerable to sudden changes in your on-chain data
flow. This is a risk vector that can be mitigated by owning your own data feed
and being your feed‚Äôs authority.</p><p>If you‚Äôre using a public data feed, consider contributing to the feeds lease to
extend its lifetime.</p><p>üí° NOTE: The feed authority differs from the lease authority. Only the lease
authority is permitted to withdraw funds. When contributing to public leases
check the lease authority is set to an empty public key or else the feed
authority could withdraw the funds for themselves.</p><h2 class="anchor anchorWithStickyNavbar_WPED" id="own-your-data">Own Your Data<a href="#own-your-data" class="hash-link" aria-label="Direct link to Own Your Data" title="Direct link to Own Your Data">‚Äã</a></h2><p>The feed authority has the power to modify the feed, including:</p><ul><li>change the job definitions and adapt to market conditions such as if a new
exchange siphoned volume from the current sources</li><li>speed up or slow down the feed depending on changing use cases</li><li>change the reporting parameters to save on cost</li><li>move the feed to a new queue for increased security or reliability</li><li>complete ownership over your on-chain data flow</li></ul><h2 class="anchor anchorWithStickyNavbar_WPED" id="dao">DAO<a href="#dao" class="hash-link" aria-label="Direct link to DAO" title="Direct link to DAO">‚Äã</a></h2><p>A feed authority could even be set to a DAO where the quorum votes on changes to
a feeds configuration. This is true decentralization at play where the settings
of a feed are optimized for a variety of use cases where voting power could be
controlled by lease contributions or tokens staked.</p><h2 class="anchor anchorWithStickyNavbar_WPED" id="tuning-a-switchboard-feed">Tuning a Switchboard Feed<a href="#tuning-a-switchboard-feed" class="hash-link" aria-label="Direct link to Tuning a Switchboard Feed" title="Direct link to Tuning a Switchboard Feed">‚Äã</a></h2><p>Now that we have some background on how switchboard oracles publish data
on-chain, let‚Äôs look at how to configure a Switchboard feed.</p><h3 class="anchor anchorWithStickyNavbar_WPED" id="data-source-diversity">Data Source Diversity<a href="#data-source-diversity" class="hash-link" aria-label="Direct link to Data Source Diversity" title="Direct link to Data Source Diversity">‚Äã</a></h3><p>The first step when building a feed is determining where you are sourcing your
data from. Each data source should correspond to a job account, which is just a
collection of Switchboard tasks, used to instruct the oracles on how to fetch
and transform data. Checkout the job directory for some example definitions. You
can also view a catalog of curated job definitions in the Switchboard publisher.</p><ul><li><strong>Job Diversity</strong> ‚Äî Ensure you‚Äôre sourcing data from multiple, reliable
sources.</li><li><strong>Job Weights</strong> ‚Äî Add job weights for sources with a higher degree of truth,
such as exchanges where price discovery is likely to happen. Oracles submit
the weighted median as their final result so jobs with a higher weight have
more influence on the result.</li><li><strong>minJobResults</strong> ‚Äî Ensure the oracles have a reliable set of data before
responding on-chain. If only 1 out of 12 sources respond, you will not have a
reliable result. But if you set this to 12 out of 12 and one of your sources
is failing, you will encounter a stale feed, so ensure you have some margin
for single source failures.</li></ul><h3 class="anchor anchorWithStickyNavbar_WPED" id="queue-selection">Queue Selection<a href="#queue-selection" class="hash-link" aria-label="Direct link to Queue Selection" title="Direct link to Queue Selection">‚Äã</a></h3><p>You should select a queue that will provide your feed with a sufficient level of
security.</p><ul><li><p><strong>Oracle Reputation</strong> ‚Äî you should select a queue with a proven track record
of honest reporting. Oracles store various metrics on-chain that can be used
to determine their reliability. Oracles are assigned to update request in a
round robin fashion where assignment is pseudo-random but this gives a fairly
accurate picture of a queues overall reliability.</p></li><li><p><strong>Oracle minStake</strong> ‚Äî you should select a queue that requires oracles to stake
a respectable sum of capital before joining the queue. This will be used to
slash oracles for misreporting feeds.</p></li><li><p><strong>Queue Reward</strong> ‚Äî your selected queue should reward oracles sufficiently
enough such that they are incentivized to report honestly, yet not too high
where update request are prohibitively expensive. Switchboard DAO queues
currently use 12500 lamports as the oracle reward, per update request.</p></li><li><p><strong>Queue Permissions</strong> ‚Äî high availability feeds should be on a queue where
unpermissionedFeedsEnabled is set to false. This prevents data feeds from
being able to join and spam the queue with update requests.</p></li><li><p><strong>Slashing</strong> ‚Äî feeds securing financial applications should be on a queue with
slashingEnabled to dissuade oracles from malicious behavior.</p><p>You may notice Switchboard DAO queues do not have all of these settings
enabled yet. Switchboard DAO queues currently rely on vetting trusted oracle
operators to bootstrap the network. As the network grows, the queues will be
further decentralized and rely on these parameters to enforce security. Stay
tuned for more information on the Switchboard DAO and how new oracles will be
permitted by the network.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_WPED" id="data-availability">Data Availability<a href="#data-availability" class="hash-link" aria-label="Direct link to Data Availability" title="Direct link to Data Availability">‚Äã</a></h3><p>Configure when and how often you need new data on-chain.</p><ul><li><strong>Crank / Automatic Updates</strong> ‚Äî any data feed that has sufficient queue
permissions is able to join a crank. A crank is a scheduling mechanism for
data feeds that will invoke a new round after each minUpdateDelay with some
added jitter to prevent predictable oracle assignment. Data feeds not on a
crank should set the option disableCrank and will need to manually requests
new updates or have their own scheduling mechanism.</li><li><strong>minUpdateDelay</strong> ‚Äî determines how often new data can be requested on-chain.
This should be set depending on your use case. Decentralized exchanges will
need faster updates than a lending protocol.</li><li><strong>varianceThreshold</strong> ‚Äî is the change percentage required between a previous
round and the current oracle result before a value is published on-chain. This
is used to conserve lease fees for the feed operator. Highly available feeds
should set this to 0 so values are always reported on-chain.</li><li><strong>forceReportPeriod</strong> ‚Äî is the max staleness for a feed. If the
varianceThreshold was not exceeded but a set number of seconds have passed,
the oracle will respond on-chain. This should almost always be used with
varianceThreshold to ensure your feed is updating as expected and not stale
for another reason.</li></ul><p>üí° NOTE: See the check_staleness function in the rust crate when integrating.</p><h3 class="anchor anchorWithStickyNavbar_WPED" id="oracle-consensus-1">Oracle Consensus<a href="#oracle-consensus-1" class="hash-link" aria-label="Direct link to Oracle Consensus" title="Direct link to Oracle Consensus">‚Äã</a></h3><p>Configure how many oracles are assigned to a request and how many must respond
to accept a result.</p><ul><li><p><strong>oracleRequestBatchSize</strong> ‚Äî sets the number of oracles assigned to each
update request. The quickest way to increase feed security is to request more
oracles each update round because it requires a higher degree of oracle
collusion in order to affect the on-chain result. In reality, this increases
the overall cost of a feed so it‚Äôs a careful consideration for feed operators
when configuring a feed.</p></li><li><p><strong>minOracleResults</strong> ‚Äî set the minimum number of oracles that must respond
before accepting a result on-chain. This ensures you have a sufficient data
set before the on-chain program takes the median of the oracle responses.</p><p>The number of oracles assigned to an update request should always be less than
the number of oracles required to respond. There are a variety of reasons that
may cause an oracle response to fail, such as Solana network degradation,
individual oracle network issues, or transaction spamming. Your feed‚Äôs lease
is only deducted when a round was successfully closed based on the feed‚Äôs
minOracleResults.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_WPED" id="cost">Cost<a href="#cost" class="hash-link" aria-label="Direct link to Cost" title="Direct link to Cost">‚Äã</a></h3><p>The two main methods to reduce a feeds cost is to:</p><ul><li><p>increase the minUpdateDelay so updates are requested less often</p></li><li><p>add a varianceTolerance so changes are only reported when a given percentage
change threshold is reached. This will greatly reduce the number of updates
on-chain during periods of low volatility so if you are using a staleness
check in your on-chain program, make sure to pair it with forceReportPeriod so
a value is always reported after a given staleness interval.</p><p>Another way to reduce cost is to set the feed authority to a DAO and share the
feed cost with other on-chain consumers. A DAO can be used to vote on feed
changes and can help democratize data on-chain. If you‚Äôre using a public data
feed, consider contributing to the feeds lease to extend its lifetime.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_WPED" id="redundancy">Redundancy<a href="#redundancy" class="hash-link" aria-label="Direct link to Redundancy" title="Direct link to Redundancy">‚Äã</a></h3><p>While Switchboard feeds have a proven track record, no system is fault tolerant
without some level of redundancy. If possible, you should pair a Switchboard
feed with another oracle provider or a TWAP feed to ensure you are viewing
reliable data. Stay tuned for a future article on advanced data feed usages.</p><h2 class="anchor anchorWithStickyNavbar_WPED" id="recommended-feed-configuration">Recommended Feed Configuration<a href="#recommended-feed-configuration" class="hash-link" aria-label="Direct link to Recommended Feed Configuration" title="Direct link to Recommended Feed Configuration">‚Äã</a></h2><p>The following table highlights some recommended settings. This will not
encompass all use cases ‚Äî use at your own discretion. Find us on Discord to
answer any configuration questions.</p><h2 class="anchor anchorWithStickyNavbar_WPED" id="feed-maintenance">Feed Maintenance<a href="#feed-maintenance" class="hash-link" aria-label="Direct link to Feed Maintenance" title="Direct link to Feed Maintenance">‚Äã</a></h2><p>The following highlights some basic maintenance you should employ when working
with a Switchboard feed.</p><ul><li><p><strong>Monitor Lease Funds</strong> ‚Äî you should monitor your feeds lease account for low
balances. When a feed‚Äôs lease is emptied, it will no longer process new
updates until it has enough to reward the oracles processing the update. We
are working with a few web3 messaging services to enable wallet notifications
when leases are low on funds.</p></li><li><p><strong>Monitor Crank Eviction</strong> ‚Äî if a lease is emptied, it will also be evicted
from its crank. Switchboard feeds act like public utilities where anyone is
free to re-push it to a crank, as long as it doesn‚Äôt have disableCrank set to
true.</p></li><li><p><strong>Monitor Data Sources</strong> ‚Äî Sometimes APIs change or move. High availability
feeds should have some basic routine health checks to ensure their on-chain
data is updating as expected.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_WPED" id="integration-checklist">Integration Checklist<a href="#integration-checklist" class="hash-link" aria-label="Direct link to Integration Checklist" title="Direct link to Integration Checklist">‚Äã</a></h2><p>The switchboard-v2 crate is used to integrate Switchboard into your on-chain
programs. You can also view some example programs in the switchboard-v2 repo.</p><ul><li><p>Check aggregator is owned by the Switchboard program</p></li><li><p>Check the latest round has more oracle responses than the minOracleResults
(get_result)</p></li><li><p>Optional, check the feed has not exceeded a given confidence interval
(check_confidence_interval)</p></li><li><p>Optional, check the feed has been updated recently (check_staleness)</p></li></ul><h2 class="anchor anchorWithStickyNavbar_WPED" id="twaps-and-historical-data">TWAPs and Historical Data<a href="#twaps-and-historical-data" class="hash-link" aria-label="Direct link to TWAPs and Historical Data" title="Direct link to TWAPs and Historical Data">‚Äã</a></h2><p>Switchboard feed owners can elect to add a history buffer to their feed. This
will automatically store the last N accepted results on-chain, where N is
configurable by the user from 1 to 350,000 samples, with the current Solana
account size limits. On-chain consumers can also read from the history buffer
and validate a subset of the history to ensure the current oracle price has not
skewed too far from the recent samples.</p><p>Once a feed has a history buffer, anyone can create a separate TWAP feed that
reads the history buffer and calculates the time weighted average. This is
useful for feeds that may have low liquidity and suffer from frequent price
swings.</p><p>More advanced usages of TWAP include the ability to source the TWAP price at
settlement each week. Let us say we‚Äôre an options protocol with contracts
settling at 5PM UTC every Friday and we need a way to source the 1hr TWAP
leading up to settlement. We also need to ensure that value is always calculated
for that 1hr window so our liquidators are using the most accurate price
observed on-chain. With Switchboard, you can build a feed that will always
resolve to that 1hr window each week. You can see it in action here on devnet.
<a href="https://switchboard.xyz/explorer/2/9wChHmbtuLbjGYt9tdH7guLY9zaqT56veSxTba18k5N3" target="_blank" rel="noopener noreferrer">https://switchboard.xyz/explorer/2/9wChHmbtuLbjGYt9tdH7guLY9zaqT56veSxTba18k5N3</a></p><p>Switchboard data feeds aim to be as general as possible to meet all use cases.
If you require a more complicated data feed, do not hesitate to reach out
because we may be able to build a custom solution that will benefit not only you
but other data feed users.</p><h2 class="anchor anchorWithStickyNavbar_WPED" id="feed-creation-walkthrough">Feed Creation Walkthrough<a href="#feed-creation-walkthrough" class="hash-link" aria-label="Direct link to Feed Creation Walkthrough" title="Direct link to Feed Creation Walkthrough">‚Äã</a></h2><p>I‚Äôm a brand new lending protocol and I need a new data feed for XYZ. Let‚Äôs walk
through some considerations I might have for how to publish this feed.</p><h3 class="anchor anchorWithStickyNavbar_WPED" id="queue-selection-1">Queue Selection<a href="#queue-selection-1" class="hash-link" aria-label="Direct link to Queue Selection" title="Direct link to Queue Selection">‚Äã</a></h3><p>This protocol will obviously be successful and have a significant total value
locked (TVL) so I should choose a secure queue. I look at a queue that already
has an XYZ feed but I notice the queue isn‚Äôt as secure as I need; maybe it has a
low minimum stake requirement for oracles or doesn‚Äôt slash oracles for
misreporting. So I check the Switchboard DAO and find a queue that requires
oracles to stake 10 SOL, has slashing enabled, requires feeds to be permitted to
join, and has a proven track record of honest reporting ‚Ä¶ perfect, we found the
queue we‚Äôll create the feed for.</p><p>üí° NOTE: Data feed owners can always move their feed to a new queue after
creation.</p><h3 class="anchor anchorWithStickyNavbar_WPED" id="data-source-diversity-1">Data Source Diversity<a href="#data-source-diversity-1" class="hash-link" aria-label="Direct link to Data Source Diversity" title="Direct link to Data Source Diversity">‚Äã</a></h3><p>Next, we‚Äôll need to find where to source the data. I see 4 centralized exchanges
and 2 decentralized exchanges. Upon further inspection, I notice one of the CEXs
has questionable volume and one of the DEXs has no volume ‚Äî so we should ignore
these sources. So we‚Äôll create the feed with 3 CEXs and 1 DEX. This is good but
let‚Äôs see if we can do better. We see theres a Saber pool for this asset so we
can use the lpExchangeRateTask to fetch the price. We can also use the
jupiterSwapTask to aggregate through various on-chain sources and get us the
best price. Awesome, we have 3 CEXs, 1 DEX, a Saber pool source, and a Jupiter
Swap source.</p><p>We want the feed result to be calculated with enough sources so we have an
accurate depiction of the price but if we keep it too strict, a single source
failing could halt the feed ‚Äî maybe one of the CEX sources had a data center
outage. Your minJobResults should be at least one less than the total number of
sources to account for this. To give us enough margin, we‚Äôll set ours to 4, so 4
out of 6 sources have to respond in order for the oracle to publish a price
update.</p><p>We notice the majority of the volume for this source is on a single CEX where
the majority of price discovery occurs ‚Äî we should definitely weigh this source
higher than the rest. Here‚Äôs what that may look like.</p><h3 class="anchor anchorWithStickyNavbar_WPED" id="data-availability-1">Data Availability<a href="#data-availability-1" class="hash-link" aria-label="Direct link to Data Availability" title="Direct link to Data Availability">‚Äã</a></h3><p>A lending protocol may not need the most up-to-date prices as compared to a
trading platform. So we will set the minUpdateDelaySeconds to 15. This should be
fast enough for our lending platform ‚Äî we can always adjust if needed.</p><p>We‚Äôre a lending protocol on-chain so we need the data to be readily available ‚Äî
so we will choose to push the feed onto a crank to enable automatic updates. The
crank is an incentivisation mechanism to regularly schedule feed updates. A
sport betting platform may opt-out of a crank since they will only need the data
when an event is settled.</p><h3 class="anchor anchorWithStickyNavbar_WPED" id="oracle-consensus-2">Oracle Consensus<a href="#oracle-consensus-2" class="hash-link" aria-label="Direct link to Oracle Consensus" title="Direct link to Oracle Consensus">‚Äã</a></h3><p>We‚Äôre planning on securing financial capital with our data feeds so we need to
ensure a malicious oracle cannot skew the price feed in its favor. To do this we
will set the oracleRequestBatchSize to at least 8. This means 5+ oracles would
have to collude in order to skew a feeds accepted value on-chain; remember we‚Äôre
using the median and not the average as the final result. We‚Äôll then set
minOracleResults to 7 to account for any oracle networking issues that may
prevent them from responding. If only 7 oracles respond, at least 4 will need to
be acting in good faith to produce an honest result ‚Äî which is a very reasonable
assumption to make since we selected our queue carefully.</p><h3 class="anchor anchorWithStickyNavbar_WPED" id="cost-1">Cost<a href="#cost-1" class="hash-link" aria-label="Direct link to Cost" title="Direct link to Cost">‚Äã</a></h3><p>Woohoo, we‚Äôre almost done. We‚Äôve built the job definitions, configured and tuned
the settings, so we head over to the Switchboard publisher to build the feed. We
get to checkout and notice the cost may be a bit high for a lending protocol
that is just starting out. No worries, let‚Äôs look at some ways to conserve cost.</p><p>Let‚Äôs look at minUpdateDelaySeconds. Updating this feed every 15 seconds may be
a bit overkill. We can increase this to 30 to double the length of the feed.</p><p>The XYZ feed is a relatively low volatility feed, meaning the prices updated
on-chain may be the same or about the same each update round. To account for
this we can set the varianceThreshold to 0.1%, which instructs the oracles to
skip reporting a value if the value hasn‚Äôt differed by 0.1% since the last
reported value on-chain. This will greatly extend the life of your feed but
makes it hard to estimate the length of time left on the feed since it will
depend on the feeds volatility and market conditions. Our feed will now only
incur a cost when a feeds value has changed significantly.</p><p>Great, we‚Äôve found some ways to reduce cost without sacrificing security. But
what if the XYZ asset suffers some loss of interest and reduce volatility? Your
feed may fail to update for hours on end if the price hasn‚Äôt moved by the set
varianceThreshold. This can be mitigated by setting a forceReportPeriod, which
instructs the oracles to always report a result on-chain even if the variance
threshold wasn‚Äôt exceeded, or max staleness. We will set forceReportPeriod to
900 so the feed will always report a value on-chain every 15minutes. When
integrating on-chain, we should always be checking if the feed was updated
within the forceReportPeriod interval to ensure the feed is healthy.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/infra/troubleshooting"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Troubleshooting</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/private-apis"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Private APIs</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_W_pa thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#oracle-consensus" class="table-of-contents__link toc-highlight">Oracle Consensus</a></li><li><a href="#democratizing-data-feeds" class="table-of-contents__link toc-highlight">Democratizing Data Feeds</a></li><li><a href="#own-your-data" class="table-of-contents__link toc-highlight">Own Your Data</a></li><li><a href="#dao" class="table-of-contents__link toc-highlight">DAO</a></li><li><a href="#tuning-a-switchboard-feed" class="table-of-contents__link toc-highlight">Tuning a Switchboard Feed</a><ul><li><a href="#data-source-diversity" class="table-of-contents__link toc-highlight">Data Source Diversity</a></li><li><a href="#queue-selection" class="table-of-contents__link toc-highlight">Queue Selection</a></li><li><a href="#data-availability" class="table-of-contents__link toc-highlight">Data Availability</a></li><li><a href="#oracle-consensus-1" class="table-of-contents__link toc-highlight">Oracle Consensus</a></li><li><a href="#cost" class="table-of-contents__link toc-highlight">Cost</a></li><li><a href="#redundancy" class="table-of-contents__link toc-highlight">Redundancy</a></li></ul></li><li><a href="#recommended-feed-configuration" class="table-of-contents__link toc-highlight">Recommended Feed Configuration</a></li><li><a href="#feed-maintenance" class="table-of-contents__link toc-highlight">Feed Maintenance</a></li><li><a href="#integration-checklist" class="table-of-contents__link toc-highlight">Integration Checklist</a></li><li><a href="#twaps-and-historical-data" class="table-of-contents__link toc-highlight">TWAPs and Historical Data</a></li><li><a href="#feed-creation-walkthrough" class="table-of-contents__link toc-highlight">Feed Creation Walkthrough</a><ul><li><a href="#queue-selection-1" class="table-of-contents__link toc-highlight">Queue Selection</a></li><li><a href="#data-source-diversity-1" class="table-of-contents__link toc-highlight">Data Source Diversity</a></li><li><a href="#data-availability-1" class="table-of-contents__link toc-highlight">Data Availability</a></li><li><a href="#oracle-consensus-2" class="table-of-contents__link toc-highlight">Oracle Consensus</a></li><li><a href="#cost-1" class="table-of-contents__link toc-highlight">Cost</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"></div></footer></div>
<script src="/assets/js/runtime~main.fbb92d72.js"></script>
<script src="/assets/js/main.a7ce8f28.js"></script>
</body>
</html>